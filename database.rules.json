{
  "rules": {
    // =========================================================
    // SUPER ADMIN (Sandesh) - Can Read/Write EVERYTHING
    // =========================================================
    ".read": "auth != null && root.child('users').child(auth.uid).child('username').val() === 'sandesh'",
    ".write": "auth != null && root.child('users').child(auth.uid).child('username').val() === 'sandesh'",
    // =========================================================
    // USERS & PROFILES
    // =========================================================
    "users": {
      "$uid": {
        // Users can read/write their own profile
        ".read": "$uid === auth.uid",
        ".write": "$uid === auth.uid"
      }
    },
    // =========================================================
    // USERNAMES (Unique Check)
    // =========================================================
    "usernames": {
      ".read": true, // Needed for "isUsernameTaken" check
      "$username": {
        // Allow claim if not exists, or update if own uid matches
        ".write": "auth != null && (!data.exists() || data.val() === auth.uid)",
        ".validate": "newData.val() === auth.uid"
      }
    },
    // =========================================================
    // CONTACT MESSAGES
    // =========================================================
    "messages": {
      // REMOVED dangerous global write.
      // Users can only push new messages (create children)
      "$messageId": {
        // Allow write if new record and userId matches auth
        ".write": "auth != null && !data.exists() && newData.child('userId').val() === auth.uid",
        // Validate schema basics
        ".validate": "newData.hasChildren(['subject', 'message', 'userId'])"
      }
    },
    // =========================================================
    // CODES (Snippets)
    // =========================================================
    "codes": {
      ".read": true,
      ".write": false // Only Admin (via root rule)
    },
    // =========================================================
    // REVIEWS
    // =========================================================
    "reviews": {
      ".read": true,
      "$reviewId": {
        // Users can create (push) new reviews but NOT edit/delete existing ones
        // Owner (via root rule) can do everything
        ".write": "auth != null && !data.exists() && newData.child('userId').val() === auth.uid",
        ".validate": "newData.hasChildren(['text', 'rating', 'userId'])"
      }
    },
    // =========================================================
    // QUOTAS (SMS/Etc)
    // =========================================================
    "quotas": {
      "$date": {
        // Allow incrementing checking quota
        ".read": "auth != null",
        ".write": "auth != null"
      }
    }
  }
}